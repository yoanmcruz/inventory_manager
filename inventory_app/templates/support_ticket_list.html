{% extends 'base.html' %}

{% block title %}Tickets de Soporte - Inventario IT{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-ticket-perforated"></i> Tickets de Soporte</h1>
    <a href="{% url 'support_ticket_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Nuevo Ticket
    </a>
</div>

<div class="card mb-4">
    <div class="card-header bg-light">
        <i class="bi bi-filter"></i> Filtros
    </div>
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-3">
                <select name="status" class="form-select">
                    <option value="">Todos los estados</option>
                    <option value="OPEN" {% if status_filter == 'OPEN' %}selected{% endif %}>Abierto</option>
                    <option value="IN_PROGRESS" {% if status_filter == 'IN_PROGRESS' %}selected{% endif %}>En Progreso</option>
                    <option value="RESOLVED" {% if status_filter == 'RESOLVED' %}selected{% endif %}>Resuelto</option>
                    <option value="CLOSED" {% if status_filter == 'CLOSED' %}selected{% endif %}>Cerrado</option>
                </select>
            </div>
            <div class="col-md-3">
                <select name="priority" class="form-select">
                    <option value="">Todas las prioridades</option>
                    <option value="LOW" {% if priority_filter == 'LOW' %}selected{% endif %}>Baja</option>
                    <option value="MED" {% if priority_filter == 'MED' %}selected{% endif %}>Media</option>
                    <option value="HIGH" {% if priority_filter == 'HIGH' %}selected{% endif %}>Alta</option>
                    <option value="CRITICAL" {% if priority_filter == 'CRITICAL' %}selected{% endif %}>Crítica</option>
                </select>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-outline-primary w-100">Filtrar</button>
            </div>
            <div class="col-md-3">
                <a href="{% url 'support_ticket_list' %}" class="btn btn-outline-secondary w-100">Limpiar</a>
            </div>
        </form>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Título</th>
                <th>Prioridad</th>
                <th>Estado</th>
                <th>Creado por</th>
                <th>Asignado a</th>
                <th>Equipo</th>
                <th>Fecha</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for ticket in tickets %}
            <tr>
                <td><strong>#{{ ticket.id }}</strong></td>
                <td>{{ ticket.title }}</td>
                <td>
                    <span class="badge 
                        {% if ticket.priority == 'LOW' %}bg-info
                        {% elif ticket.priority == 'MED' %}bg-warning
                        {% elif ticket.priority == 'HIGH' %}bg-danger
                        {% else %}bg-dark{% endif %}">
                        {{ ticket.get_priority_display }}
                    </span>
                </td>
                <td>
                    <span class="badge 
                        {% if ticket.status == 'OPEN' %}bg-primary
                        {% elif ticket.status == 'IN_PROGRESS' %}bg-warning
                        {% elif ticket.status == 'RESOLVED' %}bg-success
                        {% else %}bg-secondary{% endif %}">
                        {{ ticket.get_status_display }}
                    </span>
                </td>
                <td>{{ ticket.created_by }}</td>
                <td>
                    {% if ticket.assigned_to %}
                        {{ ticket.assigned_to }}
                    {% else %}
                        <span class="text-muted">No asignado</span>
                    {% endif %}
                </td>
                <td>
                    {% if ticket.equipment %}
                        {{ ticket.equipment }}
                    {% else %}
                        <span class="text-muted">N/A</span>
                    {% endif %}
                </td>
                <td>{{ ticket.created_at|date:"d/m/Y" }}</td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <a href="{% url 'support_ticket_detail' ticket.pk %}" class="btn btn-outline-primary">
                            <i class="bi bi-eye"></i>
                        </a>
                        {% if user.is_superuser or user == ticket.created_by.user %}
                        <a href="#" class="btn btn-outline-secondary">
                            <i class="bi bi-pencil"></i>
                        </a>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9" class="text-center text-muted py-4">
                    <i class="bi bi-inbox"></i> No se encontraron tickets
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}